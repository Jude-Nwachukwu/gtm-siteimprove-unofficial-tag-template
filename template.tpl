___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Siteimprove Unofficial",
  "brand": {
    "id": "brand_dummy",
    "displayName": "DumbData",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "This tag is used to implement Siteimprove including installing the script, executing events and tracking virtual page views.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "siTagType",
    "displayName": "Siteimprove Tracking Tag Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "siInstallScript",
        "displayValue": "Install Script"
      },
      {
        "value": "siEventTracking",
        "displayValue": "Event Tracking"
      },
      {
        "value": "siPsuedoPageLoad",
        "displayValue": "Psuedo Page Load Event"
      }
    ],
    "simpleValueType": true,
    "help": "Choose the type of Siteimprove tag you want to use."
  },
  {
    "type": "GROUP",
    "name": "siInstallScript",
    "displayName": "Siteimprove Tracking Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "siSiteimproveSiteID",
        "displayName": "Siteimprove Site ID",
        "simpleValueType": true,
        "help": "Enter your Siteimprove Site ID (found in the script as siteanalyze_xxxxx).",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "valueHint": "e.g., xxxxx"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "siTagType",
        "paramValue": "siInstallScript",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "siEventTrackingConfig",
    "displayName": "Siteimprove Event Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "siEventCategory",
        "displayName": "Siteimprove Event Category",
        "simpleValueType": true,
        "help": "Enter a value for the event category.",
        "valueHint": "e.g., Viewed Product",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "siEventAction",
        "displayName": "Siteimprove Event Action",
        "simpleValueType": true,
        "help": "Enter a value for the event action.",
        "valueHint": "e.g., Clicked Button",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "siEventLabel",
        "displayName": "Siteimprove Event Label",
        "simpleValueType": true,
        "help": "Enter a value for the event label.",
        "valueHint": "e.g., Product Page"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "siTagType",
        "paramValue": "siEventTracking",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "siIPsuedoPageLoadConfig",
    "displayName": "Psuedo Page Load Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SELECT",
        "name": "siPsuedoPageLoadTrackingMethod",
        "displayName": "Siteimprove Pseudo Page Config",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "siAutomaticPPL",
            "displayValue": "Automatic"
          },
          {
            "value": "siManualPPL",
            "displayValue": "Manual"
          }
        ],
        "simpleValueType": true,
        "help": "Choose whether to automatically capture page metadata or define it manually for the pseudo page load event.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "siPsuedoPageUrl",
        "displayName": "Page URL",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "siPsuedoPageLoadTrackingMethod",
            "paramValue": "siManualPPL",
            "type": "EQUALS"
          }
        ],
        "help": "Provide the URL of the new page.",
        "valueHint": "e.g., {{page URL}}",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "siPsuedoPageRef",
        "displayName": "Page Referrer",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "siPsuedoPageLoadTrackingMethod",
            "paramValue": "siManualPPL",
            "type": "EQUALS"
          }
        ],
        "help": "Provide the referrer URL for the new page.",
        "valueHint": "e.g., {{page referrer}}",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "siPsuedoPageTitle",
        "displayName": "Page Title",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "siPsuedoPageLoadTrackingMethod",
            "paramValue": "siManualPPL",
            "type": "EQUALS"
          }
        ],
        "help": "Enter the title of the new page.",
        "valueHint": "e.g., {{js - page title}}",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "siTagType",
        "paramValue": "siPsuedoPageLoad",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "siDocumentationLinks",
    "displayName": "➡️ Link To Siteimprove Documentation",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "LABEL",
        "name": "siDocEvent",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://help.siteimprove.com/support/solutions/articles/80000863895-getting-started-with-event-tracking\"\u003e✅ Event Documentation  Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "siTagType",
            "paramValue": "siEventTracking",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "siDocCustomVisitPPL",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://help.siteimprove.com/support/solutions/articles/80000448441-siteimprove-analytics-custom-visit-tracking\"\u003e💻 Custom Visit (Pseudo Page Load) Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "siTagType",
            "paramValue": "siPsuedoPageLoad",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "siDocInstallSiteimprove",
        "displayName": "\u003cstrong\u003e\u003ca href\u003d\"https://help.siteimprove.com/support/solutions/articles/80000448448-adding-siteimprove-analytics-javascript-to-your-website\"\u003e🛠️ Siteimprove Implementation Link\u003c/a\u003e\u003c/strong\u003e",
        "enablingConditions": [
          {
            "paramName": "siTagType",
            "paramValue": "siInstallScript",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "siOptionalConfig",
    "displayName": "Optional Configuration",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "disableConsoleLogging",
        "checkboxText": "Disable Console Logging",
        "simpleValueType": true,
        "help": "Enable this option to prevent information from appearing in the browser console."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const makeString = require('makeString');
const createQueue = require('createQueue');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const getUrl = require('getUrl');
const getReferrerUrl = require('getReferrerUrl');
const readTitle = require('readTitle');
const logToConsole = require('logToConsole');
const encodeUri = require('encodeUri');

const tagType = data.siTagType;
const loggingEnabled = !data.disableConsoleLogging;

// Siteimprove queue
const _sz = createQueue('_sz');

switch (tagType) {
  case 'siInstallScript': {
    const siteId = makeString(data.siSiteimproveSiteID);
    const scriptUrl = "https://siteimproveanalytics.com/js/siteanalyze_" + encodeUri(siteId) + ".js";

    const onSuccess = function () {
      if (loggingEnabled) logToConsole("✅ Siteimprove script loaded successfully.");
      data.gtmOnSuccess();
    };

    const onFailure = function () {
      if (loggingEnabled) logToConsole("❌ Failed to load Siteimprove script.");
      data.gtmOnFailure();
    };

    if (queryPermission('inject_script', scriptUrl)) {
      injectScript(scriptUrl, onSuccess, onFailure);
    } else {
      if (loggingEnabled) logToConsole("❌ inject_script permission denied for Siteimprove.");
      data.gtmOnFailure();
    }
    break;
  }

  case 'siEventTracking': {
    const category = makeString(data.siEventCategory);
    const action = makeString(data.siEventAction);
    const label = makeString(data.siEventLabel);

    _sz(['event', category, action, label]);
    if (loggingEnabled) logToConsole("📊 Siteimprove Event Tracked:", category, action, label);
    data.gtmOnSuccess();
    break;
  }

  case 'siPsuedoPageLoad': {
    const trackingMethod = data.siPsuedoPageLoadTrackingMethod;

    let url, ref, title;

    if (trackingMethod === 'siAutomaticPPL') {
      url = getUrl(); // full href
      ref = getReferrerUrl();
      title = readTitle();
    } else {
      url = makeString(data.siPsuedoPageUrl);
      ref = makeString(data.siPsuedoPageRef);
      title = makeString(data.siPsuedoPageTitle);
    }

    _sz(['trackdynamic', {
      url: url,
      ref: ref,
      title: title
    }]);

    if (loggingEnabled) logToConsole("📄 Siteimprove Psuedo Page Load Tracked:", { url: url, ref: ref, title: title });
    data.gtmOnSuccess();
    break;
  }

  default:
    if (loggingEnabled) logToConsole("⚠️ No matching Siteimprove tag type found:", tagType);
    data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_sz"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://siteimproveanalytics.com/js/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_title",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 3/1/2025, 4:06:51 PM


